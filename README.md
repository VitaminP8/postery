# üì∞ Postery


## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–æ—Å—Ç—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)
- GraphQL Subscriptions (realtime –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –∏ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â
- Docker + Makefile –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞


---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ

### –°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

–ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞:

```env
DB_HOST=localhost
DB_USER=user
DB_PASSWORD=password
DB_NAME=postery
DB_PORT=5432
DB_SSLMODE=disable

JWT_SECRET=very-secret-key

APP_PORT= (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º)
```


### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –≤ Docker

–°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã:

```bash
make docker-build
```

#### –ó–∞–ø—É—Å–∫ PostgreSQL-–≤–µ—Ä—Å–∏–∏:

```bash
make docker-postgres
# –∏–ª–∏ —Å –ª–æ–≥–∞–º–∏:
make docker-postgres-logs
```

#### –ó–∞–ø—É—Å–∫ in-memory –≤–µ—Ä—Å–∏–∏:

```bash
make docker-memory
# –∏–ª–∏ —Å –ª–æ–≥–∞–º–∏:
make docker-memory-logs
```

### Makefile: –∫–æ–º–∞–Ω–¥—ã

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö make –∫–æ–º–∞–Ω–¥:

```bash
make help
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

| –ö–æ–º–∞–Ω–¥–∞                        | –û–ø–∏—Å–∞–Ω–∏–µ                                           |
|-------------------------------|----------------------------------------------------|
| `make docker-build`           | –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã                              |
| `make docker-postgres`        | –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL-–≤–µ—Ä—Å–∏—é –≤ Docker               |
| `make docker-postgres-logs`   | –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL-–≤–µ—Ä—Å–∏—é –≤ Docker —Å –ª–æ–≥–∞–º–∏      |
| `make docker-memory`          | –ó–∞–ø—É—Å—Ç–∏—Ç—å in-memory –≤–µ—Ä—Å–∏—é –≤ Docker                |
| `make docker-memory-logs`     | –ó–∞–ø—É—Å—Ç–∏—Ç—å in-memory –≤–µ—Ä—Å–∏—é –≤ Docker —Å –ª–æ–≥–∞–º–∏       |
| `make docker-stop`            | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã                   |
| `make run-postgres`           | –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å PostgreSQL                      |
| `make run-memory`             | –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º            |
| `make test-clear`             | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑ —Ñ–ª–∞–≥–æ–≤                         |
| `make test`                   | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å —Ñ–ª–∞–≥–æ–º `-v`                      |
| `make test-race`              | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å —Ñ–ª–∞–≥–∞–º–∏ `-v -race`               |

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ GraphQL Playground

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –≤ `GraphQL Playground` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test_commands` ‚Äî –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –≤–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

>  *–§–∞–π–ª `test_commands` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.*

–ó–∞–ø—Ä–æ—Å—ã –≤ —Ñ–∞–π–ª–µ –ø–æ–∫—Ä—ã–≤–∞—é—Ç **–±–∞–∑–æ–≤—ã–µ –∫–µ–π—Å—ã**, –Ω–æ **–Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ –≤—Å–µ –æ—à–∏–±–∫–∏**. –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –∏ –æ—à–∏–±–æ—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö.

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:

- –ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`loginUser`) –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ **–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ**.
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`loginUser`) –≤—ã –ø–æ–ª—É—á–∏—Ç–µ **JWT-—Ç–æ–∫–µ–Ω**, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`Headers`) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–∑–∞–ø–∏—Å–µ–π (mutation)**:

```json
{
  "Authorization": "Bearer <–≤–∞—à JWT —Ç–æ–∫–µ–Ω>"
}
```

###  –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ (`subscription`)

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç—É (–∫–æ–º–∞–Ω–¥–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ `test_commands`).
2. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É –≤ GraphQL Playground.
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–æ–º—É –∂–µ –ø–æ—Å—Ç—É ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.

---

## –°–∏—Å—Ç–µ–º–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

### –ö–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å—Ç–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –ø–æ—Å—Ç—É:

- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ _n_ –∫–æ—Ä–Ω–µ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**
- –ï—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ **–µ—â–µ –æ—Å—Ç–∞–ª–∏—Å—å**, —Ç–æ:
    - —Ñ–ª–∞–≥ `hasMore: true` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    - –ø–æ–ª–µ `nextOffset` —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É


### –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–æ—Ç–≤–µ—Ç—ã)

–£ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:

- –ï—Å—Ç—å —Ñ–ª–∞–≥ `hasReplies`, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –µ—Å—Ç—å –ª–∏ —É –Ω–µ–≥–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –ø–æ–ª—è `replies` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è **–ø–µ—Ä–≤—ã–µ _n_ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** (–ª–æ–≥–∏–∫–∞ –∫–∞–∫ –∏ —Å –∫–æ—Ä–Ω–µ–≤—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ `hasMore` –∏ –ø–æ–ª–µ `nextOffset`)


```text
Post
‚îú‚îÄ Comment #1  (hasReplies: true)
‚îÇ   ‚îú‚îÄ Reply #1.1 (hasReplies: true)
‚îÇ   ‚îî‚îÄ Reply #1.2 (hasReplies: false)
‚îú‚îÄ Comment #2  (hasReplies: true)
‚îú‚îÄ Comment #3
‚îî‚îÄ ... (hasMore: true, nextOffset: 3)
```
